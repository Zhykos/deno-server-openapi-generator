{{#apiInfo}}
{{#apis}}
{{#operations}}
{{#operation}}
{{#-first}}
import { {{classname}}Service } from './services/{{classname}}Service.ts';
import { {{classname}}PrivateService } from './services/{{classname}}PrivateService.ts';
import { {{classname}}Controller } from './controllers/{{classname}}Controller.ts';
{{/-first}}
{{/operation}}
{{/operations}}
{{/apis}}
{{/apiInfo}}
import { DenoServer } from "./DenoServer.ts";
import { Application } from "./deps.ts";

export class DenoOakServer implements DenoServer {

  private app: Application;
  private port = 3000;

  constructor() {
    this.app = new Application();
  }

  create(port: number{{#apiInfo}}{{#apis}}{{#operations}}{{#operation}}{{#-first}}, my{{classname}}Service: {{classname}}Service{{/-first}}{{/operation}}{{/operations}}{{/apis}}{{/apiInfo}}): DenoOakServer {
    this.port = port;
    this.generateRoutes({{#apiInfo}}{{#apis}}{{#operations}}{{#operation}}{{#-first}}my{{classname}}Service{{/-first}}{{/operation}}, {{/operations}}{{/apis}}{{/apiInfo}});
    return this;
  }

  private generateRoutes({{#apiInfo}}{{#apis}}{{#operations}}{{#operation}}{{#-first}}my{{classname}}Service: {{classname}}Service{{/-first}}{{/operation}}, {{/operations}}{{/apis}}{{/apiInfo}}) {
    {{#apiInfo}}
    {{#apis}}
    {{#operations}}
    {{#operation}}
    {{#-first}}
    const private{{classname}}Service = new {{classname}}PrivateService(my{{classname}}Service);
    const private{{classname}}Controller = new {{classname}}Controller(private{{classname}}Service);
    {{/-first}}
    {{/operation}}
    {{/operations}}
    {{/apis}}
    {{/apiInfo}}

    this.app.use((ctx) => {
      ctx.response.body = "Hello World!";
    });
  }

  async start(): Promise<void> {
    return await this.app.listen({ port: this.port });
  }

}